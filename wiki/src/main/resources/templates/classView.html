<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">
<title th:text="${heroClass.name}"></title>
<style>
img {
	float: center;
}

.invert {
	filter: invert(100%);
	-webkit-filter: invert(100%) sepia(100%);
}
</style>
</head>
<body>
	<div class="container" style="margin-top: 25px" layout:fragment="content">
		<div class="card" th:object="${heroClass}">
			<h5 class="card-header">
				<th:block th:text="*{name}" />
				<small th:if="*{englishName}" th:text="*{'(' + englishName + ')'}"></small>
			</h5>
			<div class="card-body" th:if="*{description}" th:utext="*{description}"></div>
			<h5 class="card-header">Хиты</h5>
			<ul class="list-group list-group-flush">
				<li class="list-group-item"><b>Кость Хитов:</b> 1к<th:block th:text="*{diceHp}" /> за каждый уровень</li>
				<li class="list-group-item"><b>Хиты на 1 уровне:</b> <th:block th:text="*{diceHp}" /> + ваш модификатор Телосложения</li>
				<li class="list-group-item"><b>Хиты на следующих уровнях:</b> 1к[[*{diceHp}]] (или [[*{diceHp/2}]]) модификатор Телосложения за каждый уровень после первого</li>
			</ul>
			<h5 class="card-header">Владение</h5>
			<ul class="list-group list-group-flush">
				<li class="list-group-item"><b>Доспехи:</b> <th:bloc th:text="*{armor}" /></li>
				<li class="list-group-item"><b>Оружие:</b> <th:block th:text="*{weapon}" /></li>
				<li class="list-group-item"><b>Спаброски:</b> <th:block th:text="*{savingThrows}" /></li>
				<li class="list-group-item"><b>Навыки:</b> Выберите [[*{skillAvailableCount}]] навыка из следующих: <th:block th:if="*{skillAvailableCount == 18}">Выберите [[*{skillAvailableCount}]] любых навыка.</th:block>
					<th:block th:each="skill, iterStat : *{availableSkills}" th:text="${iterStat.last} ? ${skill.cyrilicName} : ${skill.cyrilicName} + ', '" /></li>
			</ul>
			<h5 th:if="*{equipment}" class="card-header">Снаряжение</h5>
			<div th:if="*{equipment}" class="card-body">
				<p>Вы начинаете со следующим снаряжением в дополнение к снаряжению, полученному за вашу предысторию:</p>
				<th:block th:utext="*{equipment}"></th:block>
			</div>
			<div class="card">
				<h5 class="card-header">Умения по уровням</h5>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-striped table-sm">
							<thead>
								<tr align="center">
									<th rowspan="2" style="width: 5%">Уровень</th>
									<th align="center" rowspan="2" style="width: 5%">Бонус мастерста</th>
									<th align="center" rowspan="2">Умения</th>
									<th th:each="featurelevelDefinition : *{featureLevelDefenitions}" align="center" rowspan="2" th:text="${featurelevelDefinition.name}" style="width: 5%">Умения</th>
									<th th:unless="*{levelDefenitions.empty}" align="center" colspan="9">Ячейки заклинаний на уровень заклинаний</th>
								</tr>
								<th:block th:unless="*{levelDefenitions.empty}">
									<tr align="center">
										<th>1</th>
										<th>2</th>
										<th>3</th>
										<th>4</th>
										<th>5</th>
										<th>6</th>
										<th>7</th>
										<th>8</th>
										<th>9</th>
									</tr>
								</th:block>
							</thead>
							<tbody th:with="levelDef=${ {0,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6} }">
								<tr th:each="level : ${#numbers.sequence(1, 20)}" align="center">
									<td align="center" th:text="${level}" />
									<td align="center" th:text="${'+' + levelDef[level]}" />
									<td><th:block th:each="trait : ${heroClass.getTraits(level)}">
											<th:block th:if=${trait.architype}>
												<div class="dropdown">
													<a class="dropdown-toggle" href="#" role="button" id="archetypeMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" th:text="${trait.name.toLowerCase() + ' ' }"></a>
													<div class="dropdown-menu" aria-labelledby="archetypeMenu">
														<a th:each="architypeTrait : ${heroClass.getArhitypeTraitNames(level)}"
															th:text="${#strings.toLowerCase(architypeTrait.name) + ' (' + #strings.capitalize(#strings.toLowerCase(architypeTrait.archetype.name))+')'}" class="dropdown-item"
															th:href="${'#f'+architypeTrait.name}"
														></a>
													</div>
												</div>
											</th:block>
											<a th:unless=${trait.architype} th:href="${'#t' + trait.name}" th:utext="${trait.name.toLowerCase() + '<br>' }"></a>
										</th:block></td>
									<td th:each="featureLevel : *{featureLevelDefenitions}">
									<th:block th:if="${featureLevel.prefix ne null and featureLevel.getByLevel(level) gt 0}" th:text="${featureLevel.prefix}"/><th:block th:text="${featureLevel.getByLevel(level) eq 0 ? '—': featureLevel.getByLevel(level)}" /><th:block th:if="${featureLevel.sufix ne null and featureLevel.getByLevel(level) gt 0}" th:text="${featureLevel.sufix}" /></td>
									<th:block th:unless="*{levelDefenitions.empty}">
										<td th:text="${heroClass.levelDefenitions[level - 1].slot1 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot1}" /></td>
										<td th:text="${heroClass.levelDefenitions[level - 1].slot2 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot2}" />
										<td th:text="${heroClass.levelDefenitions[level - 1].slot3 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot3}" />
										<td th:text="${heroClass.levelDefenitions[level - 1].slot4 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot4}" />
										<td th:text="${heroClass.levelDefenitions[level - 1].slot5 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot5}" />
										<td th:text="${heroClass.levelDefenitions[level - 1].slot6 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot6}" />
										<td th:text="${heroClass.levelDefenitions[level - 1].slot7 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot7}" />
										<td th:text="${heroClass.levelDefenitions[level - 1].slot8 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot8}" />
										<td th:text="${heroClass.levelDefenitions[level - 1].slot9 eq 0 ? '—' : heroClass.levelDefenitions[level - 1].slot9}" />
									</th:block>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<h5 class="card-header">Умения</h5>
				<ul class="list-group list-group-flush">
					<li th:each="trait : *{traits}" class="list-group-item" th:if="${trait.description}"><b th:id="${'t'+trait.name}"><th:block th:text="${trait.name}">:</b> <th:block
							th:utext="${trait.description}"
						/></li>
				</ul>
				<h5 class="card-header" th:text="*{archetypeName}"></h5>
				<div class="card-body">
					<div class="accordion" id="subClasses">
						<div class="card" th:each="archetype : *{archetypes}">
							<div class="card-header" th:id="${archetype.id}">
								<h5 class="mb-0">
									<img th:if="${session.settings != null and session.settings.homeRule and archetype.book.type.name() eq 'OFFICAL'}" th:src="@{/resources/official.png}" height="20" width="20"
										title="офицальное"
									>
									<button class="btn btn-link" th:text="${archetype.name}" type="button" data-toggle="collapse" th:attr="data-target='#collapse'+ ${archetype.id}, aria-controls=${'collapse'+ archetype.id}"
										aria-expanded="false"
									></button>
								</h5>
							</div>
							<div th:id="'collapse' + ${archetype.id}" class="collapse" th:attr="aria-labelledby=${archetype.id}" data-parent="#subClasses">
								<div class="card-body">
									<p th:utext="${archetype.description}"></p>
									<table class="table-striped mx-auto" th:if=${!archetype.spells.isEmpty()}>
										<thead>
											<tr>
												<th class="text-center">Уровень</th>
												<th>Заклинания</th>
											</tr>
										</thead>
										<tr th:each="element : ${archetype.levelSpells}">
											<td class="text-center" th:text="${element.key}"></td>
											<td><a th:href="@{'/hero/spells/spell/' + ${spell.id}}" th:each="spell, iterStat : ${element.value}"
												th:text="${iterStat.last} ? ${#strings.toLowerCase(spell.name)} : ${#strings.toLowerCase(spell.name)} + ', '"
											></a></td>
										</tr>
										<tbody>
										</tbody>
									</table>
									<ul class="list-group list-group-flush">
										<li th:each="feat: ${archetype.feats}" class="list-group-item"><h5 th:id="${'f'+feat.name}" class="card-title" th:text="${feat.name}" /></h5> <th:block th:utext="${feat.description}"></th:block>
									</ul>
								</div>
								<footer class="blockquote-footer" th:if="${archetype.book}" th:text="'Источник: ' + ${archetype.book.name}"></footer>
							</div>
						</div>
					</div>
				</div>
			</div>
			<h5 th:unless="${heroClass.spells.empty}" class="card-header">Доступные заклинания</h5>
			<div th:unless="${heroClass.spells.empty}" class="card-body">
				<table class="table table-hover">
					<thead>
						<tr>
							<th scope="col" style="width: 3%">Уровень<img th:src="@{/resources/open-iconic/svg/caret-bottom.svg}"></th>
							<th scope="col" style="width: 50%">Наименование</th>
							<th scope="col" style="width: 20%" class="text-center">Школа</th>
						</tr>
					</thead>
					<th:block th:each="spell : ${heroClass.spells}">
						<tr data-toggle="collapse" th:attr="data-target='#d'+ ${spell.id}">
							<td class="text-center" th:text="${spell.level}" />
							<td th:text="${spell.name}" />
							<td class="text-center">
								<div th:insert="fragments/schoolIcon :: schoolIcon(${spell})"></div>
							</td>
						</tr>
						<tr>
							<td colspan="6" class="hiddenRow">
								<div th:id="'d' + ${spell.id}" class="collapse">
									<div class="card">
										<ul class="list-group list-group-flush">
											<li class="list-group-item"><strong>Время накладывания:</strong> <th:block th:text="${spell.timeCast}" /></li>
											<li class="list-group-item"><strong>Дистанция:</strong> <th:block th:text="${spell.distance}" /></li>
											<li class="list-group-item"><strong>Компоненты:</strong> <img class="invert" th:if="${spell.verbalComponent}"
												title="Вербальный - Большинство заклинаний требуют произношения таинственных слов. Сами по себе слова не являются источником силы заклинания; просто комбинация звуков с особой тональностью вызывает резонанс в прядях магии, приводя их в движение. Таким образом, персонаж с кляпом во рту или в области заклинания тишина, не может активировать заклинания с вербальным компонентом."
												th:src="@{/resources/icons/Icon.1_74.png}" height="25"
											/> <img class="invert" th:if="${spell.somaticComponent}"
												title="Cоматический- Заклинание может требовать энергичной жестикуляции или замысловатой последовательности телодвижений. Если у заклинания есть соматический компонент, у заклинателя должна быть свободной хотя бы одна рука для исполнения этих жестов."
												th:src="@{/resources/icons/Icon.4_52.png}" height="25"
											/> <img class="invert" th:if="${spell.materialComponent}"
												title="Mатериальный - У заклинателя должна быть одна свободная рука для доступа к материальным компонентам, но это может быть та же самая рука, что используется для выполнения соматического компонента. Персонаж может использовать мешочек с компонентами или заклинательную фокусировку вместо указанных компонентов. Однако, если для компонента указана цена, у персонажа для накладывания заклинания должен быть именно такой компонент."
												th:src="@{/resources/icons/Icon.6_37.png}" height="25"
											/></li>
											<li th:if="${spell.additionalMaterialComponent != null}" class="list-group-item"><strong>Материальные компоненты:</strong> <th:block th:text="${spell.additionalMaterialComponent}" /></li>
											<li class="list-group-item"><strong>Длительность:</strong> <th:block th:text="${spell.duration}" /></li>
										</ul>
										<div class="card-body">
											<p th:utext="${spell.description}"></p>
										</div>
										<div class="card border-warning" th:if="${spell.upperLevel != null}">
											<div class="card-body">
												<h5 class="card-title">На более высоких уровнях</h5>
												<p th:text="${spell.upperLevel}"></p>
											</div>
										</div>
									</div>
									<footer class="blockquote-footer">
										<small class="text-muted" th:if="${spell.book}" th:text="'Источник: ' + ${spell.book.name}"></small>
									</footer>
								</div>
							</td>
						</tr>
					</th:block>
				</table>
			</div>
		</div>
	</div>
</body>
</html>